
Bienvenidos al laboratorio de Análisis de malware - Creación de una sandbox local.

Lo primero que vamos a hacer es preparar nuestro entorno de trabajo.

1. Descargar VirtualBox:
https://www.virtualbox.org/wiki/Downloads


2. Vamos a descargar nuestros SO que simularán de víctima y servidor DNS como salida a internet. Dependiendo del caso de uso podemos usar una máquina virtual ya preconfigurada o instalar el SO directamente en nuestro virtual box.

- La siguiente es una VM con 90 días licencia que sería el caso para simular malware en un Win 11:
https://developer.microsoft.com/en-us/windows/downloads/virtual-machines/


- Descargar iso windows 10 e instalarlo en virtualbox:
https://www.microsoft.com/es-mx/evalcenter/download-windows-10-enterprise


- Descargar Remnux 
https://app.box.com/s/8matvs5l0gc8vkr4xfq3szdm7mc9o0ad
Username: remnux
Password: malware


3. Preparar entorno win10 con herramientas para análisis de malware.
INSTALAR DEPENDENCIAS
* https://www.java.com/en/download/manual.jsp
* https://learn.microsoft.com/es-es/cpp/windows/latest-supported-vc-redist?view=msvc-170
Documentación de números mágicos: https://www.garykessler.net/library/file_sigs.html

Herramientas para análisis estático:
- https://www.nirsoft.net/utils/hash_my_files.html
- http://www.exeinfo.xn.pl
- https://www.dependencywalker.com
- https://ntcore.com/?page_id=388
- https://hex-rays.com/ida-free/#download
- https://x64dbg.com/#start

Herramientas para análisis dinámico:
- https://www.winitor.com/download
- https://download.sysinternals.com/files/SysinternalsSuite.zip
- https://processhacker.sourceforge.io/downloads.php


4. Habilitar red privada en configuraciones de virtualbox.
- En la configuración de los adaptadores de red, hay que habilitar una segunda red y configurarla como privada.
Para ello es necesario configurar la interfaz de red del remnux y la IP del windows 10.


4.1 Configurar y habilitar protocolos de red en Inetsim del remnux.


4.2 Configuramos una serie de Proxys en BurpSuite


4.3 Importar el certificado de BurpSuite en el Internet Explorer de la máquina Windows.


4.4 Seguimiento de logs en el reporte de InetSim y BurpSuite.


5. Descargar muestras infectadas:
- https://github.com/ytisf/thezoo
Pass: infected


6. Analizar malware
- Identificar algoritmo de cifrado
-  Desencriptadores de ransomwares más conocidos:
https://www.nomoreransom.org/es/index.html 



7. Anatomía de un ramsonware: Creación y puesta en producción de mi primer ramsonware.
https://github.com/HugoLB0/Ransom0



8. Propuestas y conclusiones.



9. Comentarios de buenas prácticas y medidas preventivas.
